<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Questionnaire - Section 4 | Cohen & Cohen P.C.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'law-blue': '#1e3a8a',
                        'law-gold': '#fbbf24',
                        'law-gray': '#6b7280',
                        'law-light': '#f8fafc'
                    }
                }
            }
        }
    </script>
    <style>
        .nav-item.active {
            background-color: #1e3a8a !important;
            color: white !important;
        }
        
        .nav-item.active i {
            color: white !important;
        }

        /* Sidebar collapsed state styles */
        #sidebar.w-16 .nav-item {
            justify-content: center !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
        }

        #sidebar.w-16 .nav-item i {
            margin-right: 0 !important;
        }

        #sidebar.w-16 #sidebar-header {
            justify-content: center !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
        }
    </style>
</head>
<body class="font-inter bg-law-light min-h-screen">
    <div id="app" class="flex h-screen">
        <aside id="sidebar" class="bg-white border-r border-gray-200 w-64 flex-shrink-0 transition-all duration-300">
            <div id="sidebar-header" class="flex items-center justify-between p-4 border-b border-gray-200">
                <h1 class="text-lg font-bold text-law-blue">Cohen & Cohen P.C.</h1>
                <button id="sidebar-toggle" onclick="toggleSidebar()" class="p-1 rounded-lg hover:bg-gray-100 transition-colors duration-200">
                    <i id="sidebar-toggle-icon" class="fa-solid fa-bars text-gray-600"></i>
                </button>
            </div>
            
            <nav id="sidebar-nav" class="flex-1 p-4">
                <ul class="space-y-2">
                    <li>
                        <button onclick="showSection('dashboard')" class="nav-item w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-law-blue transition-colors duration-200">
                            <i class="fa-solid fa-home mr-3 text-gray-400"></i>
                            <span>Dashboard</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('documents')" class="nav-item w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-law-blue transition-colors duration-200">
                            <i class="fa-solid fa-folder mr-3 text-gray-400"></i>
                            <span>My Documents</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('questionnaire')" class="nav-item w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-law-blue transition-colors duration-200 active">
                            <i class="fa-solid fa-clipboard-list mr-3 text-gray-400"></i>
                            <span>Financial Questionnaire</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('case-status')" class="nav-item w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-law-blue transition-colors duration-200">
                            <i class="fa-solid fa-gavel mr-3 text-gray-400"></i>
                            <span>Case Status</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('messages')" class="nav-item w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-law-blue transition-colors duration-200">
                            <i class="fa-solid fa-envelope mr-3 text-gray-400"></i>
                            <span>Messages</span>
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('appointments')" class="nav-item w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-law-blue transition-colors duration-200">
                            <i class="fa-solid fa-calendar mr-3 text-gray-400"></i>
                            <span>Appointments</span>
                        </button>
                    </li>
                </ul>
                
                <div class="border-t border-gray-200 mt-6 pt-6">
                    <ul class="space-y-2">
                        <li>
                            <button onclick="showSection('settings')" class="nav-item w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-law-blue transition-colors duration-200">
                                <i class="fa-solid fa-cog mr-3 text-gray-400"></i>
                                <span>Settings</span>
                            </button>
                        </li>
                        <li>
                            <button onclick="showSection('help')" class="nav-item w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-law-blue transition-colors duration-200">
                                <i class="fa-solid fa-question-circle mr-3 text-gray-400"></i>
                                <span>Help Centre</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-item w-full flex items-center px-3 py-2 text-sm font-medium text-red-600 rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200">
                                <i class="fa-solid fa-sign-out-alt mr-3 text-red-500"></i>
                                <span>Sign Out</span>
                            </button>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <div class="border-t border-gray-200 p-4">
                <div class="flex items-center space-x-3">
                    <img src="https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-2.jpg" alt="Client Avatar" class="w-8 h-8 rounded-full">
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 truncate">John Smith</p>
                        <p class="text-xs text-gray-500 truncate">Client ID: #12345</p>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 overflow-auto">
            <header id="header" class="bg-white border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Financial Questionnaire</h1>
                        <p class="text-law-gray">Section 4 - Unexpired Leases and Contracts (Schedule G)</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-law-gray">
                            Progress: Section 4 of 7
                        </div>
                        <img src="https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-2.jpg" alt="Client Avatar" class="w-8 h-8 rounded-full">
                    </div>
                </div>
            </header>

            <div class="p-6">
                <div class="max-w-5xl mx-auto">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
                        <div class="mb-8">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <p class="text-sm text-blue-800">
                                    <i class="fa-solid fa-info-circle mr-2"></i>
                                    List below any leases or contracts that are still current and to which you are a party. Include residential, car and business leases, and service or business contracts.
                                </p>
                            </div>
                        </div>

                        <form id="section4Form">
                            <div id="leasesContractsSection" class="mb-8">
                                <div class="p-6 bg-indigo-50 rounded-lg border border-indigo-200">
                                    <h2 class="text-xl font-semibold text-gray-900 mb-6">
                                        <i class="fa-solid fa-file-contract mr-2 text-law-blue"></i>
                                        Unexpired Leases and Contracts
                                    </h2>
                                    
                                    <div class="mb-6">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Do you have any unexpired leases or contracts?</label>
                                        <div class="flex space-x-4">
                                            <label class="flex items-center">
                                                <input type="radio" name="hasLeases" value="no" class="mr-2" onchange="toggleLeasesTable(this.value)">No
                                            </label>
                                            <label class="flex items-center">
                                                <input type="radio" name="hasLeases" value="yes" class="mr-2" onchange="toggleLeasesTable(this.value)">Yes
                                            </label>
                                        </div>
                                    </div>
                                
                                    <div id="leasesTableContainer" class="space-y-6" style="display: none;">
                                        <!-- Main Leases and Contracts Table -->
                                        <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                                            <div class="overflow-x-auto">
                                                <table class="w-full">
                                                    <thead class="bg-gray-50 border-b border-gray-200">
                                                        <tr>
                                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/5">Description of Lease or Contract</th>
                                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/5">Name and Address of Other Party or Parties</th>
                                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/5">Date Contract Expires</th>
                                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="leasesTableBody" class="divide-y divide-gray-200">
                                                        <!-- Initial rows will be added via JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        
                                        <!-- Add New Entry Button -->
                                        <div class="flex justify-center">
                                            <button type="button" id="addNewLeaseBtn" class="px-6 py-3 bg-law-blue text-white rounded-lg hover:bg-blue-800 transition-colors duration-200 flex items-center">
                                                <i class="fa-solid fa-plus mr-2"></i>
                                                Add New Lease or Contract
                                            </button>
                                        </div>
                                        
                                        <!-- Category Quick Add Section -->
                                        <div class="p-6 bg-blue-50 rounded-lg border border-blue-200">
                                            <h3 class="text-lg font-medium text-gray-800 mb-4 flex items-center">
                                                <i class="fa-solid fa-bolt mr-2 text-law-blue"></i>
                                                Quick Add by Category
                                            </h3>
                                            <p class="text-sm text-blue-800 mb-4">Select a category to quickly add a pre-formatted entry.</p>
                                            <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                                                <button type="button" class="category-btn px-4 py-2 border border-green-500 text-green-700 bg-green-50 rounded-lg hover:bg-green-100 transition-colors duration-200 text-sm" data-category="residential">
                                                    <i class="fa-solid fa-home mr-1"></i>
                                                    Residential
                                                </button>
                                                <button type="button" class="category-btn px-4 py-2 border border-blue-500 text-blue-700 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors duration-200 text-sm" data-category="vehicle">
                                                    <i class="fa-solid fa-car mr-1"></i>
                                                    Vehicle
                                                </button>
                                                <button type="button" class="category-btn px-4 py-2 border border-purple-500 text-purple-700 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors duration-200 text-sm" data-category="business">
                                                    <i class="fa-solid fa-building mr-1"></i>
                                                    Business
                                                </button>
                                                <button type="button" class="category-btn px-4 py-2 border border-yellow-500 text-yellow-700 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition-colors duration-200 text-sm" data-category="service">
                                                    <i class="fa-solid fa-handshake mr-1"></i>
                                                    Service
                                                </button>
                                                <button type="button" class="category-btn px-4 py-2 border border-gray-500 text-gray-700 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200 text-sm" data-category="other">
                                                    <i class="fa-solid fa-file-alt mr-1"></i>
                                                    Other
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <!-- Navigation Buttons -->
                            <div class="flex justify-between pt-6 border-t border-gray-200">
                                <button type="button" onclick="window.location.href='clientFinancialQuestionnaireSection3.html'" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                                    <i class="fa-solid fa-arrow-left mr-2"></i>
                                    Back to Section 3
                                </button>
                                
                                <div class="flex space-x-3">
                                    <button type="button" id="saveProgress" class="px-6 py-2 border border-law-blue text-law-blue rounded-lg hover:bg-blue-50 transition-colors duration-200">
                                        <i class="fa-solid fa-save mr-2"></i>
                                        Save Progress
                                    </button>
                                    <button type="submit" class="px-6 py-2 bg-law-blue text-white rounded-lg hover:bg-blue-800 transition-colors duration-200">
                                        Continue to Section 5
                                        <i class="fa-solid fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Toggle function for showing/hiding the leases table
        function toggleLeasesTable(value) {
            const tableContainer = document.getElementById('leasesTableContainer');
            if (value === 'yes') {
                tableContainer.style.display = 'block';
                // Add initial empty row if table is empty
                const tableBody = document.getElementById('leasesTableBody');
                if (tableBody.children.length === 0) {
                    addNewLeaseRow();
                }
            } else {
                tableContainer.style.display = 'none';
            }
        }

        // Function to add a new row to the leases table
        function addNewLeaseRow(description = '', party = '', expiry = '') {
            const tableBody = document.getElementById('leasesTableBody');
            const rowCount = tableBody.children.length + 1;
            
            const row = document.createElement('tr');
            row.className = 'lease-row';
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <textarea name="leaseDescription[]" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-law-blue focus:border-law-blue resize-none" rows="3" placeholder="e.g., Apartment rental, Car lease, Service contract">${description}</textarea>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <textarea name="leaseParty[]" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-law-blue focus:border-law-blue resize-none" rows="3" placeholder="Name and full address of the other party">${party}</textarea>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <input type="date" name="leaseExpires[]" value="${expiry}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-law-blue focus:border-law-blue">
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                    <button type="button" onclick="removeLeaseRow(this)" class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition-colors duration-200" title="Remove this entry">
                        <i class="fa-solid fa-trash text-sm"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
            
            // Auto-resize textareas
            const textareas = row.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                });
            });
        }

        // Function to remove a lease row
        function removeLeaseRow(button) {
            const row = button.closest('tr');
            const tableBody = document.getElementById('leasesTableBody');
            
            // Confirm removal if row has content
            const inputs = row.querySelectorAll('input, textarea');
            const hasContent = Array.from(inputs).some(input => input.value.trim() !== '');
            
            if (hasContent) {
                if (!confirm('Are you sure you want to remove this entry? All data will be lost.')) {
                    return;
                }
            }
            
            row.remove();
            
            // If no rows left, add an empty one
            if (tableBody.children.length === 0) {
                addNewLeaseRow();
            }
        }

        // Global sidebar functionality
        function showSection(sectionName) {
            // Check if there are section content divs (like in dashboard)
            const sections = document.querySelectorAll('.section-content');
            if (sections.length > 0) {
                // Hide all sections
                sections.forEach(section => section.classList.add('hidden'));
                
                // Show selected section
                const targetSection = document.getElementById(sectionName + '-section');
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                }
                
                // Update page title if element exists
                const pageTitleElement = document.getElementById('page-title');
                if (pageTitleElement) {
                    const titles = {
                        'dashboard': 'Dashboard',
                        'documents': 'My Documents',
                        'questionnaire': 'Financial Questionnaire',
                        'case-status': 'Case Status',
                        'messages': 'Messages',
                        'appointments': 'Appointments',
                        'settings': 'Settings',
                        'help': 'Help Centre'
                    };
                    pageTitleElement.textContent = titles[sectionName];
                }
            } else {
                // For separate pages, redirect to different pages
                const urls = {
                    'dashboard': 'clientDashboard.html',
                    'documents': 'clientDashboard.html', // Redirect to dashboard and show documents section
                    'questionnaire': 'clientFinancialQuestionnaireSection4.html',
                    'case-status': 'clientDashboard.html', // Redirect to dashboard and show case-status section
                    'messages': 'clientDashboard.html', // Redirect to dashboard and show messages section
                    'appointments': 'clientDashboard.html', // Redirect to dashboard and show appointments section
                    'settings': 'clientDashboard.html', // Redirect to dashboard and show settings section
                    'help': 'clientDashboard.html' // Redirect to dashboard and show help section
                };
                
                if (urls[sectionName]) {
                    if (sectionName === 'dashboard') {
                        window.location.href = urls[sectionName];
                    } else if (sectionName === 'questionnaire') {
                        // Stay on current questionnaire page
                        window.location.href = urls[sectionName];
                    } else {
                        // Redirect to dashboard with hash to show specific section
                        window.location.href = urls[sectionName] + '#' + sectionName;
                    }
                }
            }
            
            // Update active nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active', 'bg-law-blue', 'text-white'));
            
            // Find and activate current nav item
            const currentNavButton = Array.from(navItems).find(button => 
                button.getAttribute('onclick') && button.getAttribute('onclick').includes(sectionName)
            );
            if (currentNavButton) {
                currentNavButton.classList.add('active', 'bg-law-blue', 'text-white');
            }
        }

        // Sidebar toggle functionality
        let sidebarCollapsed = false;

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('sidebar-toggle-icon');
            
            if (!sidebarCollapsed) {
                // Collapse sidebar
                sidebar.classList.remove('w-64');
                sidebar.classList.add('w-16');
                
                // Hide text labels
                const navTexts = sidebar.querySelectorAll('nav button span');
                navTexts.forEach(text => text.classList.add('hidden'));
                
                // Hide sidebar header text
                const headerTitle = document.getElementById('sidebar-header').querySelector('h1');
                if (headerTitle) {
                    headerTitle.classList.add('hidden');
                }
                
                // Hide client info at bottom
                const clientInfo = sidebar.querySelector('.border-t.border-gray-200.p-4');
                if (clientInfo) {
                    clientInfo.classList.add('hidden');
                }
                
                // Change toggle icon to expand arrow
                toggleIcon.className = 'fa-solid fa-chevron-right text-gray-600';
                
                sidebarCollapsed = true;
            } else {
                // Expand sidebar
                sidebar.classList.remove('w-16');
                sidebar.classList.add('w-64');
                
                // Show text labels
                const navTexts = sidebar.querySelectorAll('nav button span');
                navTexts.forEach(text => text.classList.remove('hidden'));
                
                // Show sidebar header text
                const headerTitle = document.getElementById('sidebar-header').querySelector('h1');
                if (headerTitle) {
                    headerTitle.classList.remove('hidden');
                }
                
                // Show client info at bottom
                const clientInfo = sidebar.querySelector('.border-t.border-gray-200.p-4');
                if (clientInfo) {
                    clientInfo.classList.remove('hidden');
                }
                
                // Change toggle icon back to hamburger
                toggleIcon.className = 'fa-solid fa-bars text-gray-600';
                
                sidebarCollapsed = false;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Mobile sidebar toggle
            document.getElementById('mobile-sidebar-toggle')?.addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('-translate-x-full');
            });
            // Function to create a new lease entry (keeping for compatibility)
            function createLeaseEntry(placeholder = '', borderColor = 'border-gray-300') {
                const div = document.createElement('div');
                div.className = `lease-entry mb-4 p-6 bg-white rounded-lg border ${borderColor}`;
                div.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description of Lease or Contract</label>
                            <textarea name="leaseDescription[]" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-law-blue focus:border-law-blue" rows="3" placeholder="${placeholder}"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Name and Address of Other Party or Parties</label>
                            <textarea name="leaseParty[]" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-law-blue focus:border-law-blue" rows="3" placeholder="Name and address of contract party"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date Contract Expires</label>
                            <input type="date" name="leaseExpires[]" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-law-blue focus:border-law-blue">
                        </div>
                    </div>
                    <button type="button" class="mt-4 text-red-600 hover:text-red-800 text-sm" onclick="this.closest('.lease-entry').remove()">
                        <i class="fa-solid fa-trash mr-1"></i>
                        Remove Entry
                    </button>
                `;
                return div;
            }

            // Add New Lease Button functionality
            document.getElementById('addNewLeaseBtn').addEventListener('click', function() {
                addNewLeaseRow();
            });

            // Category button functionality
            document.querySelectorAll('.category-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.dataset.category;
                    let placeholder = '';
                    
                    switch(category) {
                        case 'residential':
                            placeholder = 'e.g., Apartment rental at 123 Main St';
                            break;
                        case 'vehicle':
                            placeholder = 'e.g., Car lease for 2023 Honda Civic';
                            break;
                        case 'business':
                            placeholder = 'e.g., Office space rental, Equipment lease';
                            break;
                        case 'service':
                            placeholder = 'e.g., Phone contract, Internet service agreement';
                            break;
                        case 'other':
                            placeholder = 'e.g., Gym membership, Storage unit rental';
                            break;
                    }
                    
                    addNewLeaseRow(placeholder);
                });
            });


            // Form submission
            document.getElementById('section4Form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveFormData();
                showSaveNotification('Section 4 completed successfully! Proceeding to Section 5...');
                setTimeout(() => {
                    window.location.href = 'clientFinancialQuestionnaireSection5.html';
                }, 1500);
            });
            
            // Save progress functionality
            document.getElementById('saveProgress').addEventListener('click', function() {
                saveFormData();
                showSaveNotification('Progress saved successfully!');
            });
            
            function saveFormData() {
                const formData = new FormData(document.getElementById('section4Form'));
                const data = Object.fromEntries(formData);
                localStorage.setItem('section4Data', JSON.stringify(data));
                console.log('Section 4 data saved:', data);
            }
            
            function showSaveNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-opacity duration-300';
                notification.innerHTML = `<i class="fa-solid fa-check mr-2"></i>${message}`;
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            // Auto-save functionality
            let saveTimeout;
            
            function autoSave() {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    saveFormData();
                    console.log('Auto-saved form data...');
                }, 2000);
            }

            // Add auto-save for all inputs
            document.addEventListener('input', function(e) {
                if (e.target.matches('input, select, textarea')) {
                    autoSave();
                }
            });

            document.addEventListener('change', function(e) {
                if (e.target.matches('input[type="radio"], input[type="checkbox"]')) {
                    autoSave();
                }
            });

            // Load saved data on page load
            const savedData = localStorage.getItem('section4Data');
            if (savedData) {
                const data = JSON.parse(savedData);
                Object.keys(data).forEach(key => {
                    const field = document.querySelector(`[name="${key}"]`);
                    if (field) {
                        if (field.type === 'radio') {
                            const radio = document.querySelector(`[name="${key}"][value="${data[key]}"]`);
                            if (radio) {
                                radio.checked = true;
                                // Trigger the toggle function for hasLeases radio
                                if (key === 'hasLeases') {
                                    toggleLeasesTable(data[key]);
                                }
                            }
                        } else if (field.type === 'checkbox') {
                            field.checked = data[key] === 'on';
                        } else {
                            field.value = data[key];
                        }
                    }
                });
                // Trigger change events for checkboxes
                document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                    checkbox.dispatchEvent(new Event('change'));
                });
            }
        });
        
        
        // Auto-resize textareas
        document.addEventListener('input', function(e) {
            if (e.target.tagName === 'TEXTAREA') {
                e.target.style.height = 'auto';
                e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
            }
        });
    </script>
</body>
</html>